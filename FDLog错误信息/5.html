
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script language="javascript">
      function getStyle(el,styleProp) {
        if (el.currentStyle)
          var y = el.currentStyle[styleProp];
        else if (window.getComputedStyle)
          var y = document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);
        return y;
      }
      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;
        if (el.style.display == "block") {
          el.style.display = "none";
          mark.innerHTML = "[+]";
        } else {
          el.style.display = "block";
          mark.innerHTML = "[-]";
        }
      }
      function init_expandables() {
        var elts = document.getElementsByClassName("expandable");
        for (var i = 0; i < elts.length; i++) {
          var el = elts[i];
          var clickable = el.getElementsByTagName("span")[0];
          var marker = clickable.getElementsByClassName("marker")[0];
          var content = el.getElementsByClassName("content")[0];
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.onclick = toggle;
        }
      }
      function set_class_display(c, st) {
        var elements = document.querySelectorAll('.' + c),
            len = elements.length;
        for (i = 0; i < len; i++) {
            elements[i].style.display = st;
        }
      }
      function toggle_class_visibility(id) {
        var box = document.getElementById(id);
        set_class_display(id, box.checked ? '' : 'none');
      }
    </script>
  </head>
  <body onload="init_expandables()">
      <div id="header">
        <h1>Cppcheck report - [project name]: mbedtls/library/aesni.c </h1>
      </div>
      <div id="menu" dir="rtl">
       <p id="filename"><a href="index.html">Defects:</a> aesni.c</p>
<a href='5.html#line-30'> preprocessorErrorDirective 30</a>
      </div>
      <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/*</span>
<a name="line-2"></a><span class="cm"> *  AES-NI support functions</span>
<a name="line-3"></a><span class="cm"> *</span>
<a name="line-4"></a><span class="cm"> *  Copyright (C) 2006-2015, ARM Limited, All Rights Reserved</span>
<a name="line-5"></a><span class="cm"> *  SPDX-License-Identifier: Apache-2.0</span>
<a name="line-6"></a><span class="cm"> *</span>
<a name="line-7"></a><span class="cm"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span>
<a name="line-8"></a><span class="cm"> *  not use this file except in compliance with the License.</span>
<a name="line-9"></a><span class="cm"> *  You may obtain a copy of the License at</span>
<a name="line-10"></a><span class="cm"> *</span>
<a name="line-11"></a><span class="cm"> *  http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="line-12"></a><span class="cm"> *</span>
<a name="line-13"></a><span class="cm"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="line-14"></a><span class="cm"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<a name="line-15"></a><span class="cm"> *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="line-16"></a><span class="cm"> *  See the License for the specific language governing permissions and</span>
<a name="line-17"></a><span class="cm"> *  limitations under the License.</span>
<a name="line-18"></a><span class="cm"> *</span>
<a name="line-19"></a><span class="cm"> *  This file is part of mbed TLS (https://tls.mbed.org)</span>
<a name="line-20"></a><span class="cm"> */</span>
<a name="line-21"></a>
<a name="line-22"></a><span class="cm">/*</span>
<a name="line-23"></a><span class="cm"> * [AES-WP] http://software.intel.com/en-us/articles/intel-advanced-encryption-standard-aes-instructions-set</span>
<a name="line-24"></a><span class="cm"> * [CLMUL-WP] http://software.intel.com/en-us/articles/intel-carry-less-multiplication-instruction-and-its-usage-for-computing-the-gcm-mode/</span>
<a name="line-25"></a><span class="cm"> */</span>
<a name="line-26"></a>
<a name="line-27"></a><span class="cp">#if !defined(MBEDTLS_CONFIG_FILE)</span>
<a name="line-28"></a><span class="cp">#include</span> <span class="cpf">&quot;mbedtls/config.h&quot;</span><span class="cp"></span>
<a name="line-29"></a><span class="cp">#else</span>
<a name="line-30"></a><span class="hll"><span class="cp">#include</span> <span class="cpf">MBEDTLS_CONFIG_FILE</span><span class="cp"></span><span class='error2'>&lt;--- No header in #include</span>
</span><a name="line-31"></a><span class="cp">#endif</span>
<a name="line-32"></a>
<a name="line-33"></a><span class="cp">#if defined(MBEDTLS_AESNI_C)</span>
<a name="line-34"></a>
<a name="line-35"></a><span class="cp">#include</span> <span class="cpf">&quot;mbedtls/aesni.h&quot;</span><span class="cp"></span>
<a name="line-36"></a>
<a name="line-37"></a><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<a name="line-38"></a>
<a name="line-39"></a><span class="cp">#ifndef asm</span>
<a name="line-40"></a><span class="cp">#define asm __asm</span>
<a name="line-41"></a><span class="cp">#endif</span>
<a name="line-42"></a>
<a name="line-43"></a><span class="cp">#if defined(MBEDTLS_HAVE_X86_64)</span>
<a name="line-44"></a>
<a name="line-45"></a><span class="cm">/*</span>
<a name="line-46"></a><span class="cm"> * AES-NI support detection routine</span>
<a name="line-47"></a><span class="cm"> */</span>
<a name="line-48"></a><span class="kt">int</span> <span class="nf">mbedtls_aesni_has_support</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">what</span> <span class="p">)</span>
<a name="line-49"></a><span class="p">{</span>
<a name="line-50"></a>    <span class="k">static</span> <span class="kt">int</span> <span class="n">done</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-51"></a>    <span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-52"></a>
<a name="line-53"></a>    <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="n">done</span> <span class="p">)</span>
<a name="line-54"></a>    <span class="p">{</span>
<a name="line-55"></a>        <span class="k">asm</span><span class="p">(</span> <span class="s">&quot;movl  $1, %%eax   </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-56"></a>             <span class="s">&quot;cpuid             </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-57"></a>             <span class="o">:</span> <span class="s">&quot;=c&quot;</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="line-58"></a>             <span class="o">:</span>
<a name="line-59"></a>             <span class="o">:</span> <span class="s">&quot;eax&quot;</span><span class="p">,</span> <span class="s">&quot;ebx&quot;</span><span class="p">,</span> <span class="s">&quot;edx&quot;</span> <span class="p">);</span>
<a name="line-60"></a>        <span class="n">done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-61"></a>    <span class="p">}</span>
<a name="line-62"></a>
<a name="line-63"></a>    <span class="k">return</span><span class="p">(</span> <span class="p">(</span> <span class="n">c</span> <span class="o">&amp;</span> <span class="n">what</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">);</span>
<a name="line-64"></a><span class="p">}</span>
<a name="line-65"></a>
<a name="line-66"></a><span class="cm">/*</span>
<a name="line-67"></a><span class="cm"> * Binutils needs to be at least 2.19 to support AES-NI instructions.</span>
<a name="line-68"></a><span class="cm"> * Unfortunately, a lot of users have a lower version now (2014-04).</span>
<a name="line-69"></a><span class="cm"> * Emit bytecode directly in order to support &quot;old&quot; version of gas.</span>
<a name="line-70"></a><span class="cm"> *</span>
<a name="line-71"></a><span class="cm"> * Opcodes from the Intel architecture reference manual, vol. 3.</span>
<a name="line-72"></a><span class="cm"> * We always use registers, so we don&#39;t need prefixes for memory operands.</span>
<a name="line-73"></a><span class="cm"> * Operand macros are in gas order (src, dst) as opposed to Intel order</span>
<a name="line-74"></a><span class="cm"> * (dst, src) in order to blend better into the surrounding assembly code.</span>
<a name="line-75"></a><span class="cm"> */</span>
<a name="line-76"></a><span class="cp">#define AESDEC      &quot;.byte 0x66,0x0F,0x38,0xDE,&quot;</span>
<a name="line-77"></a><span class="cp">#define AESDECLAST  &quot;.byte 0x66,0x0F,0x38,0xDF,&quot;</span>
<a name="line-78"></a><span class="cp">#define AESENC      &quot;.byte 0x66,0x0F,0x38,0xDC,&quot;</span>
<a name="line-79"></a><span class="cp">#define AESENCLAST  &quot;.byte 0x66,0x0F,0x38,0xDD,&quot;</span>
<a name="line-80"></a><span class="cp">#define AESIMC      &quot;.byte 0x66,0x0F,0x38,0xDB,&quot;</span>
<a name="line-81"></a><span class="cp">#define AESKEYGENA  &quot;.byte 0x66,0x0F,0x3A,0xDF,&quot;</span>
<a name="line-82"></a><span class="cp">#define PCLMULQDQ   &quot;.byte 0x66,0x0F,0x3A,0x44,&quot;</span>
<a name="line-83"></a>
<a name="line-84"></a><span class="cp">#define xmm0_xmm0   &quot;0xC0&quot;</span>
<a name="line-85"></a><span class="cp">#define xmm0_xmm1   &quot;0xC8&quot;</span>
<a name="line-86"></a><span class="cp">#define xmm0_xmm2   &quot;0xD0&quot;</span>
<a name="line-87"></a><span class="cp">#define xmm0_xmm3   &quot;0xD8&quot;</span>
<a name="line-88"></a><span class="cp">#define xmm0_xmm4   &quot;0xE0&quot;</span>
<a name="line-89"></a><span class="cp">#define xmm1_xmm0   &quot;0xC1&quot;</span>
<a name="line-90"></a><span class="cp">#define xmm1_xmm2   &quot;0xD1&quot;</span>
<a name="line-91"></a>
<a name="line-92"></a><span class="cm">/*</span>
<a name="line-93"></a><span class="cm"> * AES-NI AES-ECB block en(de)cryption</span>
<a name="line-94"></a><span class="cm"> */</span>
<a name="line-95"></a><span class="kt">int</span> <span class="nf">mbedtls_aesni_crypt_ecb</span><span class="p">(</span> <span class="n">mbedtls_aes_context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span>
<a name="line-96"></a>                     <span class="kt">int</span> <span class="n">mode</span><span class="p">,</span>
<a name="line-97"></a>                     <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">input</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
<a name="line-98"></a>                     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">output</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="p">)</span>
<a name="line-99"></a><span class="p">{</span>
<a name="line-100"></a>    <span class="k">asm</span><span class="p">(</span> <span class="s">&quot;movdqu    (%3), %%xmm0    </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// load input</span>
<a name="line-101"></a>         <span class="s">&quot;movdqu    (%1), %%xmm1    </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// load round key 0</span>
<a name="line-102"></a>         <span class="s">&quot;pxor      %%xmm1, %%xmm0  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// round 0</span>
<a name="line-103"></a>         <span class="s">&quot;add       $16, %1         </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// point to next round key</span>
<a name="line-104"></a>         <span class="s">&quot;subl      $1, %0          </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// normal rounds = nr - 1</span>
<a name="line-105"></a>         <span class="s">&quot;test      %2, %2          </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// mode?</span>
<a name="line-106"></a>         <span class="s">&quot;jz        2f              </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// 0 = decrypt</span>
<a name="line-107"></a>
<a name="line-108"></a>         <span class="s">&quot;1:                        </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// encryption loop</span>
<a name="line-109"></a>         <span class="s">&quot;movdqu    (%1), %%xmm1    </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// load round key</span>
<a name="line-110"></a>         <span class="n">AESENC</span>     <span class="n">xmm1_xmm0</span>      <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// do round</span>
<a name="line-111"></a>         <span class="s">&quot;add       $16, %1         </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// point to next round key</span>
<a name="line-112"></a>         <span class="s">&quot;subl      $1, %0          </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// loop</span>
<a name="line-113"></a>         <span class="s">&quot;jnz       1b              </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-114"></a>         <span class="s">&quot;movdqu    (%1), %%xmm1    </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// load round key</span>
<a name="line-115"></a>         <span class="n">AESENCLAST</span> <span class="n">xmm1_xmm0</span>      <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// last round</span>
<a name="line-116"></a>         <span class="s">&quot;jmp       3f              </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-117"></a>
<a name="line-118"></a>         <span class="s">&quot;2:                        </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// decryption loop</span>
<a name="line-119"></a>         <span class="s">&quot;movdqu    (%1), %%xmm1    </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-120"></a>         <span class="n">AESDEC</span>     <span class="n">xmm1_xmm0</span>      <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// do round</span>
<a name="line-121"></a>         <span class="s">&quot;add       $16, %1         </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-122"></a>         <span class="s">&quot;subl      $1, %0          </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-123"></a>         <span class="s">&quot;jnz       2b              </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-124"></a>         <span class="s">&quot;movdqu    (%1), %%xmm1    </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// load round key</span>
<a name="line-125"></a>         <span class="n">AESDECLAST</span> <span class="n">xmm1_xmm0</span>      <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// last round</span>
<a name="line-126"></a>
<a name="line-127"></a>         <span class="s">&quot;3:                        </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-128"></a>         <span class="s">&quot;movdqu    %%xmm0, (%4)    </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// export output</span>
<a name="line-129"></a>         <span class="o">:</span>
<a name="line-130"></a>         <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">rk</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">mode</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">input</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">output</span><span class="p">)</span>
<a name="line-131"></a>         <span class="o">:</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span><span class="p">,</span> <span class="s">&quot;xmm0&quot;</span><span class="p">,</span> <span class="s">&quot;xmm1&quot;</span> <span class="p">);</span>
<a name="line-132"></a>
<a name="line-133"></a>
<a name="line-134"></a>    <span class="k">return</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
<a name="line-135"></a><span class="p">}</span>
<a name="line-136"></a>
<a name="line-137"></a><span class="cm">/*</span>
<a name="line-138"></a><span class="cm"> * GCM multiplication: c = a times b in GF(2^128)</span>
<a name="line-139"></a><span class="cm"> * Based on [CLMUL-WP] algorithms 1 (with equation 27) and 5.</span>
<a name="line-140"></a><span class="cm"> */</span>
<a name="line-141"></a><span class="kt">void</span> <span class="nf">mbedtls_aesni_gcm_mult</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
<a name="line-142"></a>                     <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">a</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
<a name="line-143"></a>                     <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="p">)</span>
<a name="line-144"></a><span class="p">{</span>
<a name="line-145"></a>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">aa</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">cc</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<a name="line-146"></a>    <span class="kt">size_t</span> <span class="n">i</span><span class="p">;</span>
<a name="line-147"></a>
<a name="line-148"></a>    <span class="cm">/* The inputs are in big-endian order, so byte-reverse them */</span>
<a name="line-149"></a>    <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
<a name="line-150"></a>    <span class="p">{</span>
<a name="line-151"></a>        <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">15</span> <span class="o">-</span> <span class="n">i</span><span class="p">];</span>
<a name="line-152"></a>        <span class="n">bb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">15</span> <span class="o">-</span> <span class="n">i</span><span class="p">];</span>
<a name="line-153"></a>    <span class="p">}</span>
<a name="line-154"></a>
<a name="line-155"></a>    <span class="k">asm</span><span class="p">(</span> <span class="s">&quot;movdqu (%0), %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// a1:a0</span>
<a name="line-156"></a>         <span class="s">&quot;movdqu (%1), %%xmm1               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// b1:b0</span>
<a name="line-157"></a>
<a name="line-158"></a>         <span class="cm">/*</span>
<a name="line-159"></a><span class="cm">          * Caryless multiplication xmm2:xmm1 = xmm0 * xmm1</span>
<a name="line-160"></a><span class="cm">          * using [CLMUL-WP] algorithm 1 (p. 13).</span>
<a name="line-161"></a><span class="cm">          */</span>
<a name="line-162"></a>         <span class="s">&quot;movdqa %%xmm1, %%xmm2             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// copy of b1:b0</span>
<a name="line-163"></a>         <span class="s">&quot;movdqa %%xmm1, %%xmm3             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-164"></a>         <span class="s">&quot;movdqa %%xmm1, %%xmm4             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-165"></a>         <span class="n">PCLMULQDQ</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x00         </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// a0*b0 = c1:c0</span>
<a name="line-166"></a>         <span class="n">PCLMULQDQ</span> <span class="n">xmm0_xmm2</span> <span class="s">&quot;,0x11         </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// a1*b1 = d1:d0</span>
<a name="line-167"></a>         <span class="n">PCLMULQDQ</span> <span class="n">xmm0_xmm3</span> <span class="s">&quot;,0x10         </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// a0*b1 = e1:e0</span>
<a name="line-168"></a>         <span class="n">PCLMULQDQ</span> <span class="n">xmm0_xmm4</span> <span class="s">&quot;,0x01         </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// a1*b0 = f1:f0</span>
<a name="line-169"></a>         <span class="s">&quot;pxor %%xmm3, %%xmm4               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// e1+f1:e0+f0</span>
<a name="line-170"></a>         <span class="s">&quot;movdqa %%xmm4, %%xmm3             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-171"></a>         <span class="s">&quot;psrldq $8, %%xmm4                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// 0:e1+f1</span>
<a name="line-172"></a>         <span class="s">&quot;pslldq $8, %%xmm3                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// e0+f0:0</span>
<a name="line-173"></a>         <span class="s">&quot;pxor %%xmm4, %%xmm2               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// d1:d0+e1+f1</span>
<a name="line-174"></a>         <span class="s">&quot;pxor %%xmm3, %%xmm1               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// c1+e0+f1:c0</span>
<a name="line-175"></a>
<a name="line-176"></a>         <span class="cm">/*</span>
<a name="line-177"></a><span class="cm">          * Now shift the result one bit to the left,</span>
<a name="line-178"></a><span class="cm">          * taking advantage of [CLMUL-WP] eq 27 (p. 20)</span>
<a name="line-179"></a><span class="cm">          */</span>
<a name="line-180"></a>         <span class="s">&quot;movdqa %%xmm1, %%xmm3             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r1:r0</span>
<a name="line-181"></a>         <span class="s">&quot;movdqa %%xmm2, %%xmm4             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r3:r2</span>
<a name="line-182"></a>         <span class="s">&quot;psllq $1, %%xmm1                  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r1&lt;&lt;1:r0&lt;&lt;1</span>
<a name="line-183"></a>         <span class="s">&quot;psllq $1, %%xmm2                  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r3&lt;&lt;1:r2&lt;&lt;1</span>
<a name="line-184"></a>         <span class="s">&quot;psrlq $63, %%xmm3                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r1&gt;&gt;63:r0&gt;&gt;63</span>
<a name="line-185"></a>         <span class="s">&quot;psrlq $63, %%xmm4                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r3&gt;&gt;63:r2&gt;&gt;63</span>
<a name="line-186"></a>         <span class="s">&quot;movdqa %%xmm3, %%xmm5             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r1&gt;&gt;63:r0&gt;&gt;63</span>
<a name="line-187"></a>         <span class="s">&quot;pslldq $8, %%xmm3                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r0&gt;&gt;63:0</span>
<a name="line-188"></a>         <span class="s">&quot;pslldq $8, %%xmm4                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r2&gt;&gt;63:0</span>
<a name="line-189"></a>         <span class="s">&quot;psrldq $8, %%xmm5                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// 0:r1&gt;&gt;63</span>
<a name="line-190"></a>         <span class="s">&quot;por %%xmm3, %%xmm1                </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r1&lt;&lt;1|r0&gt;&gt;63:r0&lt;&lt;1</span>
<a name="line-191"></a>         <span class="s">&quot;por %%xmm4, %%xmm2                </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r3&lt;&lt;1|r2&gt;&gt;62:r2&lt;&lt;1</span>
<a name="line-192"></a>         <span class="s">&quot;por %%xmm5, %%xmm2                </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r3&lt;&lt;1|r2&gt;&gt;62:r2&lt;&lt;1|r1&gt;&gt;63</span>
<a name="line-193"></a>
<a name="line-194"></a>         <span class="cm">/*</span>
<a name="line-195"></a><span class="cm">          * Now reduce modulo the GCM polynomial x^128 + x^7 + x^2 + x + 1</span>
<a name="line-196"></a><span class="cm">          * using [CLMUL-WP] algorithm 5 (p. 20).</span>
<a name="line-197"></a><span class="cm">          * Currently xmm2:xmm1 holds x3:x2:x1:x0 (already shifted).</span>
<a name="line-198"></a><span class="cm">          */</span>
<a name="line-199"></a>         <span class="cm">/* Step 2 (1) */</span>
<a name="line-200"></a>         <span class="s">&quot;movdqa %%xmm1, %%xmm3             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// x1:x0</span>
<a name="line-201"></a>         <span class="s">&quot;movdqa %%xmm1, %%xmm4             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-202"></a>         <span class="s">&quot;movdqa %%xmm1, %%xmm5             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-203"></a>         <span class="s">&quot;psllq $63, %%xmm3                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// x1&lt;&lt;63:x0&lt;&lt;63 = stuff:a</span>
<a name="line-204"></a>         <span class="s">&quot;psllq $62, %%xmm4                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// x1&lt;&lt;62:x0&lt;&lt;62 = stuff:b</span>
<a name="line-205"></a>         <span class="s">&quot;psllq $57, %%xmm5                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// x1&lt;&lt;57:x0&lt;&lt;57 = stuff:c</span>
<a name="line-206"></a>
<a name="line-207"></a>         <span class="cm">/* Step 2 (2) */</span>
<a name="line-208"></a>         <span class="s">&quot;pxor %%xmm4, %%xmm3               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// stuff:a+b</span>
<a name="line-209"></a>         <span class="s">&quot;pxor %%xmm5, %%xmm3               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// stuff:a+b+c</span>
<a name="line-210"></a>         <span class="s">&quot;pslldq $8, %%xmm3                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// a+b+c:0</span>
<a name="line-211"></a>         <span class="s">&quot;pxor %%xmm3, %%xmm1               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// x1+a+b+c:x0 = d:x0</span>
<a name="line-212"></a>
<a name="line-213"></a>         <span class="cm">/* Steps 3 and 4 */</span>
<a name="line-214"></a>         <span class="s">&quot;movdqa %%xmm1,%%xmm0              </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// d:x0</span>
<a name="line-215"></a>         <span class="s">&quot;movdqa %%xmm1,%%xmm4              </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-216"></a>         <span class="s">&quot;movdqa %%xmm1,%%xmm5              </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-217"></a>         <span class="s">&quot;psrlq $1, %%xmm0                  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// e1:x0&gt;&gt;1 = e1:e0&#39;</span>
<a name="line-218"></a>         <span class="s">&quot;psrlq $2, %%xmm4                  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// f1:x0&gt;&gt;2 = f1:f0&#39;</span>
<a name="line-219"></a>         <span class="s">&quot;psrlq $7, %%xmm5                  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// g1:x0&gt;&gt;7 = g1:g0&#39;</span>
<a name="line-220"></a>         <span class="s">&quot;pxor %%xmm4, %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// e1+f1:e0&#39;+f0&#39;</span>
<a name="line-221"></a>         <span class="s">&quot;pxor %%xmm5, %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// e1+f1+g1:e0&#39;+f0&#39;+g0&#39;</span>
<a name="line-222"></a>         <span class="c1">// e0&#39;+f0&#39;+g0&#39; is almost e0+f0+g0, ex\tcept for some missing</span>
<a name="line-223"></a>         <span class="c1">// bits carried from d. Now get those\t bits back in.</span>
<a name="line-224"></a>         <span class="s">&quot;movdqa %%xmm1,%%xmm3              </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// d:x0</span>
<a name="line-225"></a>         <span class="s">&quot;movdqa %%xmm1,%%xmm4              </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-226"></a>         <span class="s">&quot;movdqa %%xmm1,%%xmm5              </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// same</span>
<a name="line-227"></a>         <span class="s">&quot;psllq $63, %%xmm3                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// d&lt;&lt;63:stuff</span>
<a name="line-228"></a>         <span class="s">&quot;psllq $62, %%xmm4                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// d&lt;&lt;62:stuff</span>
<a name="line-229"></a>         <span class="s">&quot;psllq $57, %%xmm5                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// d&lt;&lt;57:stuff</span>
<a name="line-230"></a>         <span class="s">&quot;pxor %%xmm4, %%xmm3               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// d&lt;&lt;63+d&lt;&lt;62:stuff</span>
<a name="line-231"></a>         <span class="s">&quot;pxor %%xmm5, %%xmm3               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// missing bits of d:stuff</span>
<a name="line-232"></a>         <span class="s">&quot;psrldq $8, %%xmm3                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// 0:missing bits of d</span>
<a name="line-233"></a>         <span class="s">&quot;pxor %%xmm3, %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// e1+f1+g1:e0+f0+g0</span>
<a name="line-234"></a>         <span class="s">&quot;pxor %%xmm1, %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// h1:h0</span>
<a name="line-235"></a>         <span class="s">&quot;pxor %%xmm2, %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// x3+h1:x2+h0</span>
<a name="line-236"></a>
<a name="line-237"></a>         <span class="s">&quot;movdqu %%xmm0, (%2)               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// done</span>
<a name="line-238"></a>         <span class="o">:</span>
<a name="line-239"></a>         <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">aa</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">bb</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">cc</span><span class="p">)</span>
<a name="line-240"></a>         <span class="o">:</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span><span class="p">,</span> <span class="s">&quot;xmm0&quot;</span><span class="p">,</span> <span class="s">&quot;xmm1&quot;</span><span class="p">,</span> <span class="s">&quot;xmm2&quot;</span><span class="p">,</span> <span class="s">&quot;xmm3&quot;</span><span class="p">,</span> <span class="s">&quot;xmm4&quot;</span><span class="p">,</span> <span class="s">&quot;xmm5&quot;</span> <span class="p">);</span>
<a name="line-241"></a>
<a name="line-242"></a>    <span class="cm">/* Now byte-reverse the outputs */</span>
<a name="line-243"></a>    <span class="k">for</span><span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
<a name="line-244"></a>        <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cc</span><span class="p">[</span><span class="mi">15</span> <span class="o">-</span> <span class="n">i</span><span class="p">];</span>
<a name="line-245"></a>
<a name="line-246"></a>    <span class="k">return</span><span class="p">;</span>
<a name="line-247"></a><span class="p">}</span>
<a name="line-248"></a>
<a name="line-249"></a><span class="cm">/*</span>
<a name="line-250"></a><span class="cm"> * Compute decryption round keys from encryption round keys</span>
<a name="line-251"></a><span class="cm"> */</span>
<a name="line-252"></a><span class="kt">void</span> <span class="nf">mbedtls_aesni_inverse_key</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">invkey</span><span class="p">,</span>
<a name="line-253"></a>                        <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fwdkey</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nr</span> <span class="p">)</span>
<a name="line-254"></a><span class="p">{</span>
<a name="line-255"></a>    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ik</span> <span class="o">=</span> <span class="n">invkey</span><span class="p">;</span>
<a name="line-256"></a>    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fk</span> <span class="o">=</span> <span class="n">fwdkey</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">nr</span><span class="p">;</span>
<a name="line-257"></a>
<a name="line-258"></a>    <span class="n">memcpy</span><span class="p">(</span> <span class="n">ik</span><span class="p">,</span> <span class="n">fk</span><span class="p">,</span> <span class="mi">16</span> <span class="p">);</span>
<a name="line-259"></a>
<a name="line-260"></a>    <span class="k">for</span><span class="p">(</span> <span class="n">fk</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">ik</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span> <span class="n">fk</span> <span class="o">&gt;</span> <span class="n">fwdkey</span><span class="p">;</span> <span class="n">fk</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">ik</span> <span class="o">+=</span> <span class="mi">16</span> <span class="p">)</span>
<a name="line-261"></a>        <span class="k">asm</span><span class="p">(</span> <span class="s">&quot;movdqu (%0), %%xmm0       </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-262"></a>             <span class="n">AESIMC</span>  <span class="n">xmm0_xmm0</span>         <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-263"></a>             <span class="s">&quot;movdqu %%xmm0, (%1)       </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-264"></a>             <span class="o">:</span>
<a name="line-265"></a>             <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">fk</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ik</span><span class="p">)</span>
<a name="line-266"></a>             <span class="o">:</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;xmm0&quot;</span> <span class="p">);</span>
<a name="line-267"></a>
<a name="line-268"></a>    <span class="n">memcpy</span><span class="p">(</span> <span class="n">ik</span><span class="p">,</span> <span class="n">fk</span><span class="p">,</span> <span class="mi">16</span> <span class="p">);</span>
<a name="line-269"></a><span class="p">}</span>
<a name="line-270"></a>
<a name="line-271"></a><span class="cm">/*</span>
<a name="line-272"></a><span class="cm"> * Key expansion, 128-bit case</span>
<a name="line-273"></a><span class="cm"> */</span>
<a name="line-274"></a><span class="k">static</span> <span class="kt">void</span> <span class="nf">aesni_setkey_enc_128</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rk</span><span class="p">,</span>
<a name="line-275"></a>                                  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="p">)</span>
<a name="line-276"></a><span class="p">{</span>
<a name="line-277"></a>    <span class="k">asm</span><span class="p">(</span> <span class="s">&quot;movdqu (%1), %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// copy the original key</span>
<a name="line-278"></a>         <span class="s">&quot;movdqu %%xmm0, (%0)               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// as round key 0</span>
<a name="line-279"></a>         <span class="s">&quot;jmp 2f                            </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// skip auxiliary routine</span>
<a name="line-280"></a>
<a name="line-281"></a>         <span class="cm">/*</span>
<a name="line-282"></a><span class="cm">          * Finish generating the next round key.</span>
<a name="line-283"></a><span class="cm">          *</span>
<a name="line-284"></a><span class="cm">          * On entry xmm0 is r3:r2:r1:r0 and xmm1 is X:stuff:stuff:stuff</span>
<a name="line-285"></a><span class="cm">          * with X = rot( sub( r3 ) ) ^ RCON.</span>
<a name="line-286"></a><span class="cm">          *</span>
<a name="line-287"></a><span class="cm">          * On exit, xmm0 is r7:r6:r5:r4</span>
<a name="line-288"></a><span class="cm">          * with r4 = X + r0, r5 = r4 + r1, r6 = r5 + r2, r7 = r6 + r3</span>
<a name="line-289"></a><span class="cm">          * and those are written to the round key buffer.</span>
<a name="line-290"></a><span class="cm">          */</span>
<a name="line-291"></a>         <span class="s">&quot;1:                                </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-292"></a>         <span class="s">&quot;pshufd $0xff, %%xmm1, %%xmm1      </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// X:X:X:X</span>
<a name="line-293"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm1               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// X+r3:X+r2:X+r1:r4</span>
<a name="line-294"></a>         <span class="s">&quot;pslldq $4, %%xmm0                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r2:r1:r0:0</span>
<a name="line-295"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm1               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// X+r3+r2:X+r2+r1:r5:r4</span>
<a name="line-296"></a>         <span class="s">&quot;pslldq $4, %%xmm0                 </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// etc</span>
<a name="line-297"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm1               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-298"></a>         <span class="s">&quot;pslldq $4, %%xmm0                 </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-299"></a>         <span class="s">&quot;pxor %%xmm1, %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// update xmm0 for next time!</span>
<a name="line-300"></a>         <span class="s">&quot;add $16, %0                       </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// point to next round key</span>
<a name="line-301"></a>         <span class="s">&quot;movdqu %%xmm0, (%0)               </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// write it</span>
<a name="line-302"></a>         <span class="s">&quot;ret                               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-303"></a>
<a name="line-304"></a>         <span class="cm">/* Main &quot;loop&quot; */</span>
<a name="line-305"></a>         <span class="s">&quot;2:                                </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-306"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x01        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-307"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x02        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-308"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x04        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-309"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x08        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-310"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x10        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-311"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x20        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-312"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x40        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-313"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x80        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-314"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x1B        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-315"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm1</span> <span class="s">&quot;,0x36        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-316"></a>         <span class="o">:</span>
<a name="line-317"></a>         <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rk</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a name="line-318"></a>         <span class="o">:</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span> <span class="p">);</span>
<a name="line-319"></a><span class="p">}</span>
<a name="line-320"></a>
<a name="line-321"></a><span class="cm">/*</span>
<a name="line-322"></a><span class="cm"> * Key expansion, 192-bit case</span>
<a name="line-323"></a><span class="cm"> */</span>
<a name="line-324"></a><span class="k">static</span> <span class="kt">void</span> <span class="nf">aesni_setkey_enc_192</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rk</span><span class="p">,</span>
<a name="line-325"></a>                                  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="p">)</span>
<a name="line-326"></a><span class="p">{</span>
<a name="line-327"></a>    <span class="k">asm</span><span class="p">(</span> <span class="s">&quot;movdqu (%1), %%xmm0   </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// copy original round key</span>
<a name="line-328"></a>         <span class="s">&quot;movdqu %%xmm0, (%0)   </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-329"></a>         <span class="s">&quot;add $16, %0           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-330"></a>         <span class="s">&quot;movq 16(%1), %%xmm1   </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-331"></a>         <span class="s">&quot;movq %%xmm1, (%0)     </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-332"></a>         <span class="s">&quot;add $8, %0            </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-333"></a>         <span class="s">&quot;jmp 2f                </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// skip auxiliary routine</span>
<a name="line-334"></a>
<a name="line-335"></a>         <span class="cm">/*</span>
<a name="line-336"></a><span class="cm">          * Finish generating the next 6 quarter-keys.</span>
<a name="line-337"></a><span class="cm">          *</span>
<a name="line-338"></a><span class="cm">          * On entry xmm0 is r3:r2:r1:r0, xmm1 is stuff:stuff:r5:r4</span>
<a name="line-339"></a><span class="cm">          * and xmm2 is stuff:stuff:X:stuff with X = rot( sub( r3 ) ) ^ RCON.</span>
<a name="line-340"></a><span class="cm">          *</span>
<a name="line-341"></a><span class="cm">          * On exit, xmm0 is r9:r8:r7:r6 and xmm1 is stuff:stuff:r11:r10</span>
<a name="line-342"></a><span class="cm">          * and those are written to the round key buffer.</span>
<a name="line-343"></a><span class="cm">          */</span>
<a name="line-344"></a>         <span class="s">&quot;1:                            </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-345"></a>         <span class="s">&quot;pshufd $0x55, %%xmm2, %%xmm2  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// X:X:X:X</span>
<a name="line-346"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm2           </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// X+r3:X+r2:X+r1:r4</span>
<a name="line-347"></a>         <span class="s">&quot;pslldq $4, %%xmm0             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// etc</span>
<a name="line-348"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm2           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-349"></a>         <span class="s">&quot;pslldq $4, %%xmm0             </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-350"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm2           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-351"></a>         <span class="s">&quot;pslldq $4, %%xmm0             </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-352"></a>         <span class="s">&quot;pxor %%xmm2, %%xmm0           </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// update xmm0 = r9:r8:r7:r6</span>
<a name="line-353"></a>         <span class="s">&quot;movdqu %%xmm0, (%0)           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-354"></a>         <span class="s">&quot;add $16, %0                   </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-355"></a>         <span class="s">&quot;pshufd $0xff, %%xmm0, %%xmm2  </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r9:r9:r9:r9</span>
<a name="line-356"></a>         <span class="s">&quot;pxor %%xmm1, %%xmm2           </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// stuff:stuff:r9+r5:r10</span>
<a name="line-357"></a>         <span class="s">&quot;pslldq $4, %%xmm1             </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// r2:r1:r0:0</span>
<a name="line-358"></a>         <span class="s">&quot;pxor %%xmm2, %%xmm1           </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// xmm1 = stuff:stuff:r11:r10</span>
<a name="line-359"></a>         <span class="s">&quot;movq %%xmm1, (%0)             </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-360"></a>         <span class="s">&quot;add $8, %0                    </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-361"></a>         <span class="s">&quot;ret                           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-362"></a>
<a name="line-363"></a>         <span class="s">&quot;2:                            </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-364"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x01    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-365"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x02    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-366"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x04    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-367"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x08    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-368"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x10    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-369"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x20    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-370"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x40    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-371"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x80    </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-372"></a>
<a name="line-373"></a>         <span class="o">:</span>
<a name="line-374"></a>         <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rk</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a name="line-375"></a>         <span class="o">:</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span> <span class="p">);</span>
<a name="line-376"></a><span class="p">}</span>
<a name="line-377"></a>
<a name="line-378"></a><span class="cm">/*</span>
<a name="line-379"></a><span class="cm"> * Key expansion, 256-bit case</span>
<a name="line-380"></a><span class="cm"> */</span>
<a name="line-381"></a><span class="k">static</span> <span class="kt">void</span> <span class="nf">aesni_setkey_enc_256</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rk</span><span class="p">,</span>
<a name="line-382"></a>                                  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span> <span class="p">)</span>
<a name="line-383"></a><span class="p">{</span>
<a name="line-384"></a>    <span class="k">asm</span><span class="p">(</span> <span class="s">&quot;movdqu (%1), %%xmm0           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-385"></a>         <span class="s">&quot;movdqu %%xmm0, (%0)           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-386"></a>         <span class="s">&quot;add $16, %0                   </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-387"></a>         <span class="s">&quot;movdqu 16(%1), %%xmm1         </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-388"></a>         <span class="s">&quot;movdqu %%xmm1, (%0)           </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-389"></a>         <span class="s">&quot;jmp 2f                        </span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="c1">// skip auxiliary routine</span>
<a name="line-390"></a>
<a name="line-391"></a>         <span class="cm">/*</span>
<a name="line-392"></a><span class="cm">          * Finish generating the next two round keys.</span>
<a name="line-393"></a><span class="cm">          *</span>
<a name="line-394"></a><span class="cm">          * On entry xmm0 is r3:r2:r1:r0, xmm1 is r7:r6:r5:r4 and</span>
<a name="line-395"></a><span class="cm">          * xmm2 is X:stuff:stuff:stuff with X = rot( sub( r7 )) ^ RCON</span>
<a name="line-396"></a><span class="cm">          *</span>
<a name="line-397"></a><span class="cm">          * On exit, xmm0 is r11:r10:r9:r8 and xmm1 is r15:r14:r13:r12</span>
<a name="line-398"></a><span class="cm">          * and those have been written to the output buffer.</span>
<a name="line-399"></a><span class="cm">          */</span>
<a name="line-400"></a>         <span class="s">&quot;1:                                </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-401"></a>         <span class="s">&quot;pshufd $0xff, %%xmm2, %%xmm2      </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-402"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm2               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-403"></a>         <span class="s">&quot;pslldq $4, %%xmm0                 </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-404"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm2               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-405"></a>         <span class="s">&quot;pslldq $4, %%xmm0                 </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-406"></a>         <span class="s">&quot;pxor %%xmm0, %%xmm2               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-407"></a>         <span class="s">&quot;pslldq $4, %%xmm0                 </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-408"></a>         <span class="s">&quot;pxor %%xmm2, %%xmm0               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-409"></a>         <span class="s">&quot;add $16, %0                       </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-410"></a>         <span class="s">&quot;movdqu %%xmm0, (%0)               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-411"></a>
<a name="line-412"></a>         <span class="cm">/* Set xmm2 to stuff:Y:stuff:stuff with Y = subword( r11 )</span>
<a name="line-413"></a><span class="cm">          * and proceed to generate next round key from there */</span>
<a name="line-414"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm0_xmm2</span> <span class="s">&quot;,0x00        </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-415"></a>         <span class="s">&quot;pshufd $0xaa, %%xmm2, %%xmm2      </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-416"></a>         <span class="s">&quot;pxor %%xmm1, %%xmm2               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-417"></a>         <span class="s">&quot;pslldq $4, %%xmm1                 </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-418"></a>         <span class="s">&quot;pxor %%xmm1, %%xmm2               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-419"></a>         <span class="s">&quot;pslldq $4, %%xmm1                 </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-420"></a>         <span class="s">&quot;pxor %%xmm1, %%xmm2               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-421"></a>         <span class="s">&quot;pslldq $4, %%xmm1                 </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-422"></a>         <span class="s">&quot;pxor %%xmm2, %%xmm1               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-423"></a>         <span class="s">&quot;add $16, %0                       </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-424"></a>         <span class="s">&quot;movdqu %%xmm1, (%0)               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-425"></a>         <span class="s">&quot;ret                               </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-426"></a>
<a name="line-427"></a>         <span class="cm">/*</span>
<a name="line-428"></a><span class="cm">          * Main &quot;loop&quot; - Generating one more key than necessary,</span>
<a name="line-429"></a><span class="cm">          * see definition of mbedtls_aes_context.buf</span>
<a name="line-430"></a><span class="cm">          */</span>
<a name="line-431"></a>         <span class="s">&quot;2:                                </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-432"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x01        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-433"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x02        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-434"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x04        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-435"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x08        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-436"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x10        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-437"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x20        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-438"></a>         <span class="n">AESKEYGENA</span> <span class="n">xmm1_xmm2</span> <span class="s">&quot;,0x40        </span><span class="se">\n\t</span><span class="s">call 1b </span><span class="se">\n\t</span><span class="s">&quot;</span>
<a name="line-439"></a>         <span class="o">:</span>
<a name="line-440"></a>         <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rk</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a name="line-441"></a>         <span class="o">:</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span> <span class="p">);</span>
<a name="line-442"></a><span class="p">}</span>
<a name="line-443"></a>
<a name="line-444"></a><span class="cm">/*</span>
<a name="line-445"></a><span class="cm"> * Key expansion, wrapper</span>
<a name="line-446"></a><span class="cm"> */</span>
<a name="line-447"></a><span class="kt">int</span> <span class="nf">mbedtls_aesni_setkey_enc</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rk</span><span class="p">,</span>
<a name="line-448"></a>                      <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span>
<a name="line-449"></a>                      <span class="kt">size_t</span> <span class="n">bits</span> <span class="p">)</span>
<a name="line-450"></a><span class="p">{</span>
<a name="line-451"></a>    <span class="k">switch</span><span class="p">(</span> <span class="n">bits</span> <span class="p">)</span>
<a name="line-452"></a>    <span class="p">{</span>
<a name="line-453"></a>        <span class="k">case</span> <span class="mi">128</span><span class="o">:</span> <span class="n">aesni_setkey_enc_128</span><span class="p">(</span> <span class="n">rk</span><span class="p">,</span> <span class="n">key</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
<a name="line-454"></a>        <span class="k">case</span> <span class="mi">192</span><span class="o">:</span> <span class="n">aesni_setkey_enc_192</span><span class="p">(</span> <span class="n">rk</span><span class="p">,</span> <span class="n">key</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
<a name="line-455"></a>        <span class="k">case</span> <span class="mi">256</span><span class="o">:</span> <span class="n">aesni_setkey_enc_256</span><span class="p">(</span> <span class="n">rk</span><span class="p">,</span> <span class="n">key</span> <span class="p">);</span> <span class="k">break</span><span class="p">;</span>
<a name="line-456"></a>        <span class="k">default</span> <span class="o">:</span> <span class="k">return</span><span class="p">(</span> <span class="n">MBEDTLS_ERR_AES_INVALID_KEY_LENGTH</span> <span class="p">);</span>
<a name="line-457"></a>    <span class="p">}</span>
<a name="line-458"></a>
<a name="line-459"></a>    <span class="k">return</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
<a name="line-460"></a><span class="p">}</span>
<a name="line-461"></a>
<a name="line-462"></a><span class="cp">#endif </span><span class="cm">/* MBEDTLS_HAVE_X86_64 */</span><span class="cp"></span>
<a name="line-463"></a>
<a name="line-464"></a><span class="cp">#endif </span><span class="cm">/* MBEDTLS_AESNI_C */</span><span class="cp"></span>
</pre></div>
</td></tr></table>
      </div>
      <div id="footer">
        <p>
         Cppcheck 1.87 - a tool for static C/C++ code analysis</br>
         </br>
         Internet: <a href="http://cppcheck.net">http://cppcheck.net</a></br>
         IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a></br>
        <p>
      </div>
  </body>
</html>
