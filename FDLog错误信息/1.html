
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script language="javascript">
      function getStyle(el,styleProp) {
        if (el.currentStyle)
          var y = el.currentStyle[styleProp];
        else if (window.getComputedStyle)
          var y = document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);
        return y;
      }
      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;
        if (el.style.display == "block") {
          el.style.display = "none";
          mark.innerHTML = "[+]";
        } else {
          el.style.display = "block";
          mark.innerHTML = "[-]";
        }
      }
      function init_expandables() {
        var elts = document.getElementsByClassName("expandable");
        for (var i = 0; i < elts.length; i++) {
          var el = elts[i];
          var clickable = el.getElementsByTagName("span")[0];
          var marker = clickable.getElementsByClassName("marker")[0];
          var content = el.getElementsByClassName("content")[0];
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.onclick = toggle;
        }
      }
      function set_class_display(c, st) {
        var elements = document.querySelectorAll('.' + c),
            len = elements.length;
        for (i = 0; i < len; i++) {
            elements[i].style.display = st;
        }
      }
      function toggle_class_visibility(id) {
        var box = document.getElementById(id);
        set_class_display(id, box.checked ? '' : 'none');
      }
    </script>
  </head>
  <body onload="init_expandables()">
      <div id="header">
        <h1>Cppcheck report - [project name]: FDLog-Demo/fd_construct_data.c </h1>
      </div>
      <div id="menu" dir="rtl">
       <p id="filename"><a href="index.html">Defects:</a> fd_construct_data.c</p>
<a href='1.html#line-119'> nullPointerRedundantCheck 119</a><a href='1.html#line-120'> nullPointerRedundantCheck 120</a><a href='1.html#line-161'> uselessAssignmentPtrArg 161</a>
      </div>
      <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<a name="line-2"></a><span class="cp">#include</span> <span class="cpf">&quot;cJSON.h&quot;</span><span class="cp"></span>
<a name="line-3"></a><span class="cp">#include</span> <span class="cpf">&quot;stdlib.h&quot;</span><span class="cp"></span>
<a name="line-4"></a><span class="cp">#include</span> <span class="cpf">&quot;fd_construct_data.h&quot;</span><span class="cp"></span>
<a name="line-5"></a><span class="cp">#include</span> <span class="cpf">&quot;fd_json_helper.h&quot;</span><span class="cp"></span>
<a name="line-6"></a><span class="cp">#include</span> <span class="cpf">&quot;fd_console_helper.h&quot;</span><span class="cp"></span>
<a name="line-7"></a><span class="cp">#include</span> <span class="cpf">&quot;fd_core_model.h&quot;</span><span class="cp"></span>
<a name="line-8"></a>
<a name="line-9"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdlog_key</span> <span class="o">=</span> <span class="s">&quot;c&quot;</span><span class="p">;</span>                   <span class="c1">// 类型: String 日志内容 例如: &quot; 这里需要注意，我出现问题了 &quot;</span>
<a name="line-10"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdlog_type</span> <span class="o">=</span> <span class="s">&quot;lt&quot;</span><span class="p">;</span>                 <span class="c1">// 类型: Int 日志类型 例如: 业务日志(2), 性能日志(1), 崩溃日志(0)</span>
<a name="line-11"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdflag_key</span> <span class="o">=</span> <span class="s">&quot;f&quot;</span><span class="p">;</span>                  <span class="c1">// 类型: String 日志模块 例如: VOM ，SO ，MER 等等</span>
<a name="line-12"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdlog_level</span> <span class="o">=</span> <span class="s">&quot;lv&quot;</span><span class="p">;</span>                <span class="c1">// 类型: Int 日志等级 例如: Info Warning Error</span>
<a name="line-13"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdlocaltime_key</span> <span class="o">=</span> <span class="s">&quot;l&quot;</span><span class="p">;</span>             <span class="c1">// 类型: String 日志记录时间 例如: 1558427368</span>
<a name="line-14"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdthreadname_key</span> <span class="o">=</span> <span class="s">&quot;n&quot;</span><span class="p">;</span>            <span class="c1">// 类型: String 日志线程名字 例如: FDLogThread</span>
<a name="line-15"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdthreadid_key</span> <span class="o">=</span> <span class="s">&quot;i&quot;</span><span class="p">;</span>              <span class="c1">// 类型: Int 日志线程ID 例如: 4 , 5, 10</span>
<a name="line-16"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdismain_key</span> <span class="o">=</span> <span class="s">&quot;m&quot;</span><span class="p">;</span>                <span class="c1">// 类型: Int 日志是否是主线程 例如: 1 , 0</span>
<a name="line-17"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdlog_version</span> <span class="o">=</span> <span class="s">&quot;v&quot;</span><span class="p">;</span>               <span class="c1">// 类型: Int 日志本地版本 例如: 1 , 2 , 3 , 4 等等</span>
<a name="line-18"></a>
<a name="line-19"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdapp_net</span> <span class="o">=</span> <span class="s">&quot;nt&quot;</span><span class="p">;</span>                  <span class="c1">// 类型: String 网络环境 例如: HRPD 4G 3G 2G GPRS 2.75G EDGE 等等</span>
<a name="line-20"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fduser_system_name</span> <span class="o">=</span> <span class="s">&quot;sys_n&quot;</span><span class="p">;</span>      <span class="c1">// 类型: String 手机操作系统名称 例如: Android, iOS</span>
<a name="line-21"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdapp_name</span> <span class="o">=</span> <span class="s">&quot;an&quot;</span><span class="p">;</span>                 <span class="c1">// 类型: String App名字 例如: NioApp, NioMate, ToolKit 等等</span>
<a name="line-22"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdapp_version</span> <span class="o">=</span> <span class="s">&quot;av&quot;</span><span class="p">;</span>              <span class="c1">// 类型: String App版本 例如: 3.5.0 , 3.5.1, 4.0.0 等等</span>
<a name="line-23"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdphone_brand</span> <span class="o">=</span> <span class="s">&quot;pb&quot;</span><span class="p">;</span>              <span class="c1">// 类型: String 手机品牌 例如: Apple, HuaWei, ViVo 等等</span>
<a name="line-24"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fduser_id</span> <span class="o">=</span> <span class="s">&quot;ui&quot;</span><span class="p">;</span>                  <span class="c1">// 类型: String 用户id 例如: 12700912, 12700913 等等</span>
<a name="line-25"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fduser_name</span> <span class="o">=</span> <span class="s">&quot;un&quot;</span><span class="p">;</span>                <span class="c1">// 类型: String 用户名字 例如: YongPeng.Zhu, Tony.Zou 等等</span>
<a name="line-26"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fduser_device</span> <span class="o">=</span> <span class="s">&quot;ud&quot;</span><span class="p">;</span>              <span class="c1">// 类型: String 用户设备详细信息 例如: &quot;iPhoneX 12.2 MQA52CH/A&quot; 等等</span>
<a name="line-27"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fduser_system_version</span> <span class="o">=</span> <span class="s">&quot;sys_v&quot;</span><span class="p">;</span>   <span class="c1">// 类型: String 手机操作系统版本 例如: 12.1 , 10.1 等</span>
<a name="line-28"></a><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fdidentifier</span> <span class="o">=</span> <span class="s">&quot;uid&quot;</span><span class="p">;</span>              <span class="c1">// 类型: String 单条日志唯一id 建议用uuid</span>
<a name="line-29"></a>
<a name="line-30"></a>
<a name="line-31"></a><span class="n">FD_Construct_Data</span> <span class="o">*</span>
<a name="line-32"></a><span class="nf">fd_construct_json_data</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">log</span><span class="p">,</span>
<a name="line-33"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">flag</span><span class="p">,</span>
<a name="line-34"></a>                       <span class="kt">long</span> <span class="kt">long</span> <span class="n">local_time</span><span class="p">,</span>
<a name="line-35"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">thread_name</span><span class="p">,</span>
<a name="line-36"></a>                       <span class="kt">long</span> <span class="kt">long</span> <span class="n">thread_id</span><span class="p">,</span>
<a name="line-37"></a>                       <span class="kt">int</span> <span class="n">is_main</span><span class="p">,</span>
<a name="line-38"></a>                       <span class="kt">int</span> <span class="n">level</span><span class="p">,</span>
<a name="line-39"></a>                       <span class="kt">int</span> <span class="n">log_type</span><span class="p">,</span>
<a name="line-40"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">app_net</span><span class="p">,</span>
<a name="line-41"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">user_system_name</span><span class="p">,</span>
<a name="line-42"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">app_name</span><span class="p">,</span>
<a name="line-43"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">app_version</span><span class="p">,</span>
<a name="line-44"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">phone_brand</span><span class="p">,</span>
<a name="line-45"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">user_id</span><span class="p">,</span>
<a name="line-46"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">user_name</span><span class="p">,</span>
<a name="line-47"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">user_device</span><span class="p">,</span>
<a name="line-48"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">user_system_version</span><span class="p">,</span>
<a name="line-49"></a>                       <span class="kt">char</span> <span class="o">*</span><span class="n">identifier</span><span class="p">)</span> <span class="p">{</span>
<a name="line-50"></a>    
<a name="line-51"></a>    <span class="n">FD_Construct_Data</span> <span class="o">*</span><span class="n">construct_data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-52"></a>    <span class="n">cJSON</span> <span class="o">*</span><span class="n">root</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-53"></a>    <span class="n">fd_json_map</span> <span class="o">*</span><span class="n">map</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-54"></a>    
<a name="line-55"></a>    <span class="n">root</span> <span class="o">=</span> <span class="n">cJSON_CreateObject</span><span class="p">();</span>
<a name="line-56"></a>    <span class="n">map</span> <span class="o">=</span> <span class="n">fd_create_json_map</span><span class="p">();</span>
<a name="line-57"></a>    
<a name="line-58"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">root</span><span class="p">)</span> <span class="p">{</span>
<a name="line-59"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">map</span><span class="p">)</span> <span class="p">{</span>
<a name="line-60"></a>            
<a name="line-61"></a>            <span class="c1">// 日志内容</span>
<a name="line-62"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdlog_key</span><span class="p">,</span> <span class="n">log</span><span class="p">);</span>
<a name="line-63"></a>            <span class="c1">// 日志模块名字: Vom SO 等等</span>
<a name="line-64"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdflag_key</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
<a name="line-65"></a>            <span class="c1">// 记录时间</span>
<a name="line-66"></a>            <span class="n">fd_add_item_number</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdlocaltime_key</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">local_time</span><span class="p">);</span>
<a name="line-67"></a>            <span class="c1">// 线程名字</span>
<a name="line-68"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdthreadname_key</span><span class="p">,</span> <span class="n">thread_name</span><span class="p">);</span>
<a name="line-69"></a>            <span class="c1">// 线程ID</span>
<a name="line-70"></a>            <span class="n">fd_add_item_number</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdthreadid_key</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">thread_id</span><span class="p">);</span>
<a name="line-71"></a>            <span class="c1">// 是否在主线程</span>
<a name="line-72"></a>            <span class="n">fd_add_item_bool</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdismain_key</span><span class="p">,</span> <span class="n">is_main</span><span class="p">);</span>
<a name="line-73"></a>            <span class="c1">// 日志版本: 1</span>
<a name="line-74"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdlog_version</span><span class="p">,</span> <span class="n">FD_VERSION_NUMBER</span><span class="p">);</span>
<a name="line-75"></a>            <span class="c1">// 日志等级: Info(2) Warning(1) Error(0)</span>
<a name="line-76"></a>            <span class="n">fd_add_item_number</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdlog_level</span><span class="p">,</span> <span class="n">level</span><span class="p">);</span>
<a name="line-77"></a>            <span class="c1">// 日志类型: 业务日志 性能日志 等等</span>
<a name="line-78"></a>            <span class="n">fd_add_item_number</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdlog_type</span><span class="p">,</span> <span class="n">log_type</span><span class="p">);</span>
<a name="line-79"></a>            <span class="c1">// 网络环境: 2G 4G</span>
<a name="line-80"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdapp_net</span><span class="p">,</span> <span class="n">app_net</span><span class="p">);</span>
<a name="line-81"></a>            <span class="c1">// 手机操作系统名字: Android</span>
<a name="line-82"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fduser_system_name</span><span class="p">,</span> <span class="n">user_system_name</span><span class="p">);</span>
<a name="line-83"></a>            <span class="c1">// 应用名字: NioApp</span>
<a name="line-84"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdapp_name</span><span class="p">,</span> <span class="n">app_name</span><span class="p">);</span>
<a name="line-85"></a>            <span class="c1">// 应用版本: 4.0.0</span>
<a name="line-86"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdapp_version</span><span class="p">,</span> <span class="n">app_version</span><span class="p">);</span>
<a name="line-87"></a>            <span class="c1">// 手机品牌: HuaWei</span>
<a name="line-88"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdphone_brand</span><span class="p">,</span> <span class="n">phone_brand</span><span class="p">);</span>
<a name="line-89"></a>            <span class="c1">// 用户ID: 44r1d14412</span>
<a name="line-90"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fduser_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">);</span>
<a name="line-91"></a>            <span class="c1">// 用户名字: Yongpeng.Zhu</span>
<a name="line-92"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fduser_name</span><span class="p">,</span> <span class="n">user_name</span><span class="p">);</span>
<a name="line-93"></a>            <span class="c1">// 用户设备详细信息: iPhoneX 12.2 MQA52CH/A</span>
<a name="line-94"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fduser_device</span><span class="p">,</span> <span class="n">user_device</span><span class="p">);</span>
<a name="line-95"></a>            <span class="c1">// 用户系统版本: 12.1</span>
<a name="line-96"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fduser_system_version</span><span class="p">,</span> <span class="n">user_system_version</span><span class="p">);</span>
<a name="line-97"></a>            <span class="c1">// UUID单条日志文件唯一标识符: ASDFGHJKASDFGHSDF</span>
<a name="line-98"></a>            <span class="n">fd_add_item_string</span><span class="p">(</span><span class="n">map</span><span class="p">,</span> <span class="n">fdidentifier</span><span class="p">,</span> <span class="n">identifier</span><span class="p">);</span>
<a name="line-99"></a>            
<a name="line-100"></a>            <span class="n">fd_inflate_json_by_map</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">map</span><span class="p">);</span>
<a name="line-101"></a>            
<a name="line-102"></a>            <span class="c1">// 生成Jsonstring</span>
<a name="line-103"></a>            <span class="kt">char</span> <span class="o">*</span><span class="n">back_data</span> <span class="o">=</span> <span class="n">cJSON_PrintUnformatted</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<a name="line-104"></a>            
<a name="line-105"></a>            <span class="n">fd_printf</span><span class="p">(</span><span class="s">&quot;FDLog: log content is %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">back_data</span><span class="p">);</span>
<a name="line-106"></a>            
<a name="line-107"></a>            <span class="c1">// 为FD_Construct_Data申请堆内存</span>
<a name="line-108"></a>            <span class="n">construct_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">FD_Construct_Data</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">FD_Construct_Data</span><span class="p">));</span>
<a name="line-109"></a>            
<a name="line-110"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">construct_data</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 申请成功</span>
<a name="line-111"></a>                <span class="c1">// 清空 construct_data</span>
<a name="line-112"></a>                <span class="n">memset</span><span class="p">(</span><span class="n">construct_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">FD_Construct_Data</span><span class="p">));</span>
<a name="line-113"></a>                
<a name="line-114"></a>                <span class="c1">// 得到日志jsonstring的内容长度</span>
<a name="line-115"></a>                <span class="kt">size_t</span> <span class="n">str_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">back_data</span><span class="p">);</span>
<a name="line-116"></a>                <span class="c1">// 长度+1 在后面拼加 &#39;\n&#39; 换行符号。</span>
<a name="line-117"></a>                <span class="kt">size_t</span> <span class="n">length</span> <span class="o">=</span> <span class="n">str_len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-118"></a>                <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">temp_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">length</span><span class="p">);</span>
<a name="line-119"></a><span class="hll">                <span class="n">memset</span><span class="p">(</span><span class="n">temp_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span><span class='error2'>&lt;--- Null pointer dereference</span>
</span><a name="line-120"></a><span class="hll">                <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">temp_data</span><span class="p">)</span> <span class="p">{</span><span class='error2'>&lt;--- Assuming that condition 'NULL!=temp_data' is not redundant</span>
</span><a name="line-121"></a>                    
<a name="line-122"></a>                    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">temp_point</span> <span class="o">=</span> <span class="n">temp_data</span><span class="p">;</span>
<a name="line-123"></a>                    <span class="n">memset</span><span class="p">(</span><span class="n">temp_point</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<a name="line-124"></a>                    <span class="n">memcpy</span><span class="p">(</span><span class="n">temp_point</span><span class="p">,</span> <span class="n">back_data</span><span class="p">,</span> <span class="n">str_len</span><span class="p">);</span>
<a name="line-125"></a>                    <span class="n">temp_point</span> <span class="o">+=</span> <span class="n">str_len</span><span class="p">;</span>
<a name="line-126"></a>                    <span class="kt">char</span> <span class="n">return_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">&#39;\n&#39;</span><span class="p">};</span>
<a name="line-127"></a>                    <span class="n">memcpy</span><span class="p">(</span><span class="n">temp_point</span><span class="p">,</span> <span class="n">return_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//添加\n字符</span>
<a name="line-128"></a>                    <span class="n">construct_data</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">temp_data</span><span class="p">;</span> <span class="c1">//赋值</span>
<a name="line-129"></a>                    <span class="n">construct_data</span><span class="o">-&gt;</span><span class="n">data_len</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">length</span><span class="p">;</span>
<a name="line-130"></a>                    
<a name="line-131"></a>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a name="line-132"></a>                    
<a name="line-133"></a>                    <span class="n">free</span><span class="p">(</span><span class="n">construct_data</span><span class="p">);</span>
<a name="line-134"></a>                    <span class="n">construct_data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-135"></a>                    <span class="n">fd_printf</span><span class="p">(</span>
<a name="line-136"></a>                            <span class="s">&quot;fdlog: construct_json_data_clogan &gt; malloc memory fail for temp_data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a name="line-137"></a>                <span class="p">}</span>
<a name="line-138"></a>            <span class="p">}</span>
<a name="line-139"></a>            
<a name="line-140"></a>            <span class="n">free</span><span class="p">(</span><span class="n">back_data</span><span class="p">);</span>
<a name="line-141"></a>            <span class="n">back_data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-142"></a>        <span class="p">}</span>
<a name="line-143"></a>        <span class="n">cJSON_Delete</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<a name="line-144"></a>    <span class="p">}</span>
<a name="line-145"></a>    
<a name="line-146"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">map</span><span class="p">)</span> <span class="p">{</span>
<a name="line-147"></a>        <span class="n">fd_delete_json_map</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
<a name="line-148"></a>    <span class="p">}</span>
<a name="line-149"></a>    
<a name="line-150"></a>    <span class="k">return</span> <span class="n">construct_data</span><span class="p">;</span>
<a name="line-151"></a><span class="p">}</span>
<a name="line-152"></a>
<a name="line-153"></a>
<a name="line-154"></a><span class="kt">void</span> <span class="nf">fd_construct_data_delete</span><span class="p">(</span><span class="n">FD_Construct_Data</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span> <span class="p">{</span>
<a name="line-155"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
<a name="line-156"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">!=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
<a name="line-157"></a>            <span class="n">free</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<a name="line-158"></a>            <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-159"></a>        <span class="p">}</span>
<a name="line-160"></a>        <span class="n">free</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<a name="line-161"></a><span class="hll">        <span class="n">item</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span><span class='error2'>&lt;--- Assignment of function parameter has no effect outside the function. Did you forget dereferencing it?</span>
</span><a name="line-162"></a>    <span class="p">}</span>
<a name="line-163"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div>
      <div id="footer">
        <p>
         Cppcheck 1.87 - a tool for static C/C++ code analysis</br>
         </br>
         Internet: <a href="http://cppcheck.net">http://cppcheck.net</a></br>
         IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a></br>
        <p>
      </div>
  </body>
</html>
